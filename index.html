<!DOCTYPE html>
<html>
  <head>
    <style>
      h1 {
        text-align: center;
      }
    </style>
  </head>
  <body>
    <h1>O Mighty Sound Effects Lady</h1>

    <figure>
      <figcaption>Losing horn :(</figcaption>
      <audio controls="" id="losing-horn">
        <source src="losing-horn.mp3" type="audio/mpeg" />
      </audio>

      <figcaption>MAIN THEME (loops)</figcaption>
      <audio controls="" loop="" id="main-theme">
        <source src="main-theme.mp3" type="audio/mpeg" />
      </audio>

      <button onclick="fadeVolumeOnDemand('main-theme', 3, 0.2)" type="button">Fade Down</button>
      <button onclick="fadeVolumeOnDemand('main-theme', 3, 1)" type="button">Fade Up</button>
      <button onclick="stopAudio('main-theme')" type="button">■</button>

      <figcaption>Come on down! (loop)</figcaption>
      <audio controls="" loop="" id="come-on-down">
        <source src="come-on-down.mp3" type="audio/mpeg" />
      </audio>

      <button onclick="fadeVolumeOnDemand('come-on-down', 3, 0.2)" type="button">Fade Down</button>
      <button onclick="fadeVolumeOnDemand('come-on-down', 3, 1)" type="button">Fade Up</button>
      <button onclick="stopAudio('come-on-down')" type="button">■</button>
    </figure>

    <script>
      function stopAudio(audioId) {
        var audio = document.getElementById(audioId);
        audio.pause();
        audio.currentTime = 0;
      }

      function fadeVolumeOnDemand(audioId, duration, targetVolume) {
        var sound = document.getElementById(audioId);

        let numIncrements = 20;

        // Want to reach targetVolume -- if targetVolume is GREATER than volume, then we add positive increment; otherwise, we add negative increment
        var volIncrement = (targetVolume - sound.volume) / numIncrements;

        var fadeAudio = setInterval(function () {
          if ((volIncrement > 0 && sound.volume < targetVolume) || (volIncrement < 0 && sound.volume > targetVolume)) { // Either the increment is positive and we want to add volume until we reach the target, or increment is negative and we subtract (by adding negative) until we reach the target
            sound.volume = Math.max(Math.min(1, sound.volume + volIncrement), 0);
          } else {
            sound.volume = targetVolume;
            clearInterval(fadeAudio);
          }
        }, duration * 1000 / numIncrements);
      }
    </script>
  </body>
</html>
